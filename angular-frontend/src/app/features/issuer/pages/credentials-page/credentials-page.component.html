<!--
* Ability to select multiple cards for issuance in your credential (product cart style?)
* Indicator that immunization record is already on your credential
-->

<div class="container pt-4">
  <div class="row">
    <div class="col col-lg-8">

      <app-page-header title="Obtain Your Health Status Credential">
        <ng-container appPageHeaderSummary>
          Use this portal to generate a credential you can use when you need to provide proof of vaccination or negative
          test results. These will be stored in a digital wallet on your personal device. You can choose what
          information you include in the credential.
        </ng-container>
      </app-page-header>

    </div>
  </div>
  <div class="row">
    <div class="col">

      <button mat-stroked-button
              class="mb-4">
        <mat-icon color="primary">add</mat-icon> Add All
      </button>

    </div>
  </div>
  <div class="row">
    <div class="col col-md-9 col-lg-7 col-xl-6">

      <ng-container *ngFor="let record of immunizationRecords">

        <app-card-alert icon="coronavirus"
                        subtitle="Immunization Record"
                        [title]="record.vaccine.disease"
                        alertType="info"
                        alertIcon="notification_important"
                        alertMessage="Immunization record has not been added to your credential"
                        (selected)="addSelectedImmunizationRecord(record)">
          <mat-card-content>
            <mat-list dense>
              <mat-list-item>
                <h3 matLine>Manufacturer</h3>
                <p matLine>{{ record.vaccine.manufacturer }}</p>
              </mat-list-item>
              <mat-list-item>
                <h3 matLine>Date of Administration</h3>
                <p matLine>{{ record.dateOfVaccination | formatDate: 'MMMM DD, YYYY' }}</p>
              </mat-list-item>
            </mat-list>

            <app-mat-card-expansion [immunizationRecord]="record"></app-mat-card-expansion>
          </mat-card-content>
        </app-card-alert>

      </ng-container>

    </div>
    <div class="col col-md-9 col-lg-4">
      <div class="sticky-top">

        <mat-card class="temporary">
          <mat-card-subtitle>Verifiable Credential</mat-card-subtitle>
          <mat-card-title>Immunization Records</mat-card-title>
          <mat-card-content>

            <ng-container *ngIf="selectedImmunizationRecords.length; else noSelectedImmunizationRecords">

              <p class="summary">
                List of immunization records that you've selected to be added to your digial wallet:
              </p>

              <mat-list dense>
                <mat-divider></mat-divider>
                <ng-container *ngFor="let record of selectedImmunizationRecords">
                  <mat-list-item>
                    <p matLine>{{ record.vaccine.disease }}</p>
                    <button mat-icon-button
                            (click)="removeSelectedImmunizationRecord(record.id)">
                      <mat-icon>close</mat-icon>
                    </button>
                  </mat-list-item>
                  <mat-divider></mat-divider>
                </ng-container>
              </mat-list>

              <p class="mt-3">
                By clicking <strong>Create Credential</strong> you will create a Verifiable Credential with the listed
                immunization records.
              </p>

            </ng-container>

            <ng-template #noSelectedImmunizationRecords>
              <p class="no-selection">
                No immunization records selected for your digital wallet.
              </p>
            </ng-template>

          </mat-card-content>

          <mat-card-actions *ngIf="selectedImmunizationRecords.length"
                            class="p-3">
            <button mat-flat-button
                    color="primary"
                    class="w-100"
                    (click)="onCreateCredential()">Create Credential</button>
          </mat-card-actions>

          <app-qrcode [base64QRCode]="issuedCredential"></app-qrcode>
        </mat-card>

      </div>
    </div>
  </div>
</div>
