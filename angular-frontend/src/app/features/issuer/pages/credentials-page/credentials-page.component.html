<!--
* Ability to select multiple cards for issuance in your credential (product cart style?)
* Indicator that immunization record is already on your credential
-->

<div class="container pt-4">
  <div class="row">
    <div class="col col-lg-8">

      <app-page-header title="Obtain Your Health Status Credential">
        <ng-container appPageHeaderSummary>
          Use this portal to generate a credential you can use when you need to provide proof of vaccination or negative
          test results. These will be stored in a digital wallet on your personal device. You can choose what
          information you include in the credential.
        </ng-container>
      </app-page-header>

    </div>
  </div>
  <div class="row">
    <div class="col">

      <button mat-stroked-button
              class="mb-4">
        <mat-icon color="primary">add</mat-icon> Add All
      </button>

    </div>
  </div>
  <div class="row">
    <div class="col col-md-9 col-lg-7 col-xl-6">

      <ng-container *ngFor="let record of immunizationRecords">

        <app-card-alert icon="coronavirus"
                        subtitle="Immunization Record"
                        [title]="record.vaccine.disease">

        </app-card-alert>

        <mat-card class="immunization-record">
          <mat-card-header>
            <div mat-card-avatar>
              <mat-icon color="primary">coronavirus</mat-icon>
            </div>

            <mat-card-subtitle>Immunization Record</mat-card-subtitle>
            <mat-card-title>{{ record.vaccine.disease }}</mat-card-title>

            <button mat-icon-button
                    [matMenuTriggerFor]="rootMenu">
              <mat-icon color="primary">more_vert</mat-icon>
            </button>

            <mat-menu #rootMenu="matMenu"
                      aria-label="Immunization record action menu">
              <button mat-menu-item>
                <mat-icon color="primary">qr_code_scanner</mat-icon>
                <span>Add to Credential</span>
              </button>
            </mat-menu>
          </mat-card-header>

          <mat-card-content>
            <mat-list dense>
              <mat-list-item>
                <h3 matLine>Manufacturer</h3>
                <p matLine>{{ record.vaccine.manufacturer }}</p>
              </mat-list-item>
              <mat-list-item>
                <h3 matLine>Date of Administration</h3>
                <p matLine>{{ record.dateOfVaccination | formatDate: 'MMMM DD, YYYY' }}</p>
              </mat-list-item>
            </mat-list>

            <app-mat-card-expansion [immunizationRecord]="record"></app-mat-card-expansion>
          </mat-card-content>

          <mat-card-footer>
            <div class="d-flex align-items-center">
              <div class="mr-4">
                <mat-icon color="primary">notification_important</mat-icon>
              </div>
              <div class="mr-sm-4">
                Immunization record has not been added to your credential
              </div>
              <div class="ms-auto d-none d-sm-block">
                <ng-container [ngTemplateOutlet]="addToCredential"
                              [ngTemplateOutletContext]="{ immunizationRecord: record }"></ng-container>
              </div>
            </div>

            <div class="d-block d-sm-none">
              <ng-container [ngTemplateOutlet]="addToCredential"
                            [ngTemplateOutletContext]="{ immunizationRecord: record, cssClass: 'w-100 mt-3' }">
              </ng-container>
            </div>
          </mat-card-footer>
        </mat-card>

      </ng-container>

      <ng-template #addToCredential
                   let-immunizationRecord="immunizationRecord"
                   let-cssClass="cssClass">
        <button mat-flat-button
                color="primary"
                [class]="cssClass">
          Add to Credential
        </button>
      </ng-template>

      <app-qrcode [base64QRCode]="issuedCredential"></app-qrcode>

    </div>
    <div class="col col-lg-4">
      <!-- TODO make into side menu from right? -->

      <div class="sticky-top">

        <mat-card>
          <mat-card-subtitle>Verifiable Credential</mat-card-subtitle>
          <mat-card-title>Immunization Records</mat-card-title>
          <mat-card-content>

            <p>
              You have not added any immunization records to be used with your verifiable credential.
            </p>

            <mat-list dense>
              <mat-list-item>
                <p matLine>COVID-19</p>
                <button mat-icon-button>
                  <mat-icon>close</mat-icon>
                </button>
              </mat-list-item>
              <mat-divider></mat-divider>

              <mat-list-item>
                <p matLine>COVID-19</p>
                <button mat-icon-button>
                  <mat-icon>close</mat-icon>
                </button>
              </mat-list-item>
              <mat-divider></mat-divider>

              <mat-list-item>
                <p matLine>COVID-19</p>
                <button mat-icon-button>
                  <mat-icon>close</mat-icon>
                </button>
              </mat-list-item>
              <mat-divider></mat-divider>
            </mat-list>

            <p class="mt-3">
              By clicking <strong>Create Credential</strong> you will create a Verifiable Credential with the listed
              immunization records.
            </p>

          </mat-card-content>
          <mat-card-actions class="p-3">
            <button mat-flat-button
                    color="primary"
                    class="w-100">Create Credential</button>
          </mat-card-actions>
        </mat-card>

      </div>
    </div>
  </div>
</div>
